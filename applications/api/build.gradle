apply from: "../../kotlin.gradle"
apply plugin: 'com.github.johnrengelman.shadow'

dependencies {
    compile project(":components:articles-api")

    compile "io.dropwizard:dropwizard-core:$dropwizardVersion"
    compile "com.zaxxer:HikariCP:$hikariVersion"
    compile "org.postgresql:postgresql:$postgresVersion"
    compile "com.fasterxml.jackson.module:jackson-module-kotlin:$jacksonVersion"
}

jar {
    manifest {
        attributes("Main-Class": "com.somanyfeeds.api.AppKt")
    }
}

shadowJar {
    mergeServiceFiles()
}

task("run", type: Exec, dependsOn: "shadowJar") {
    environment VCAP_SERVICES: """{
      "postgres": [
        {
          "label": "", "name": "", "tags": [],
          "credentials": {
            "uri": "postgres://dam5s@localhost:5432/somanyfeeds_dev"
          }
        }
      ]
    }
    """

    workingDir project.projectDir
    commandLine "java", "-jar", "build/libs/api-all.jar", "server", "config.yml"
}
